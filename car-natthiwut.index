<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>‡∏ä‡∏≥‡∏£‡∏∞‡∏Ñ‡πà‡∏≤‡∏á‡∏ß‡∏î‡∏£‡∏ñ</title>
<style>
  :root{
    --bg: #f7f8fa;
    --card: #ffffff;
    --text: #111;
    --muted:#606a77;
    --primary: #2b6cb0;
    --accent:#2b6cb0;
    --border:#e6e6e6;
    --danger:#d32f2f;
    --success:#2e7d32;
  }
  /* THEMES */
  .theme-blue   { --bg:#f5faff; --card:#ffffff; --text:#0d1b2a; --muted:#52606d; --primary:#2b6cb0; --accent:#2b6cb0; --border:#e6eef7; }
  .theme-pink   { --bg:#fff7fb; --card:#ffffff; --text:#301934; --muted:#6b5b6e; --primary:#d16ba5; --accent:#d16ba5; --border:#f5e3ef; }
  .theme-white  { --bg:#ffffff; --card:#ffffff; --text:#111;    --muted:#666;    --primary:#444;    --accent:#444;    --border:#eaeaea; }
  .theme-black  { --bg:#0f1115; --card:#171a21; --text:#f5f6f8; --muted:#9aa4b2; --primary:#5da0ff; --accent:#5da0ff; --border:#242833; }
  .theme-rosegold{--bg:#fff9f7; --card:#ffffff; --text:#341c1a; --muted:#7a5e5b; --primary:#b76e79; --accent:#b76e79; --border:#f3e3df; }
  .theme-yellow { --bg:#fffdf3; --card:#ffffff; --text:#1c1a00; --muted:#6b6a52; --primary:#e0b100; --accent:#e0b100; --border:#f3edd0; }
  .theme-orange { --bg:#fff8f3; --card:#ffffff; --text:#27160b; --muted:#6e5b50; --primary:#ff8a3d; --accent:#ff8a3d; --border:#fde3d3; }
  .theme-red    { --bg:#fff5f5; --card:#ffffff; --text:#2a0b0b; --muted:#6b4a4a; --primary:#e63946; --accent:#e63946; --border:#f5d4d6; }
  .theme-purple { --bg:#f8f5ff; --card:#ffffff; --text:#231942; --muted:#6c648b; --primary:#7c4dff; --accent:#7c4dff; --border:#ebe4ff; }
  .theme-teal   { --bg:#eefcfa; --card:#ffffff; --text:#012d2a; --muted:#4e6e6b; --primary:#009688; --accent:#009688; --border:#dbf2ef; }
  .theme-green  { --bg:#f3fff5; --card:#ffffff; --text:#06330e; --muted:#4e6e57; --primary:#2e7d32; --accent:#2e7d32; --border:#e0f2e6; }
  .theme-slate  { --bg:#f6f7f9; --card:#ffffff; --text:#0f172a; --muted:#64748b; --primary:#334155; --accent:#334155; --border:#e5e7eb; }
  .theme-brown  { --bg:#fff8f2; --card:#ffffff; --text:#3e2723; --muted:#6d4c41; --primary:#8d6e63; --accent:#8d6e63; --border:#efebe9; }
  .theme-lavender{--bg:#faf6ff; --card:#ffffff; --text:#251b37; --muted:#6c6291; --primary:#b388ff; --accent:#b388ff; --border:#efe9ff; }
  .theme-mint   { --bg:#f3fff9; --card:#ffffff; --text:#083b2b; --muted:#5f7f74; --primary:#36c2a5; --accent:#36c2a5; --border:#dff5ee; }
  .theme-navy   { --bg:#eef3ff; --card:#ffffff; --text:#0b1b3b; --muted:#4b5a7a; --primary:#2643e9; --accent:#2643e9; --border:#dee5ff; }

  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; background:var(--bg); color:var(--text);
    font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,"Noto Sans Thai",sans-serif;
    -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
  }
  .wrap{ max-width:980px; margin-inline:auto; padding:20px 14px 80px; position:relative; }

  header{ display:flex; align-items:center; gap:16px; margin-top:6px; margin-bottom:16px; flex-wrap:wrap; }
  .avatar{ width:170px; height:170px; border-radius:50%; overflow:hidden; border:3px solid var(--border); background:#ddd; flex:0 0 auto; }
  .avatar img{ width:100%; height:100%; object-fit:cover; display:block; }
  .titlebox{ display:flex; flex-direction:column; gap:6px; min-width:220px; }
  .name{ font-size:22px; font-weight:800; }
  .subtitle{ color:var(--muted); font-size:13.5px; }

  .settings-btn{ position:fixed; top:12px; right:12px; z-index:60; border:1px solid var(--border); background:var(--card);
    color:var(--text); border-radius:12px; padding:10px 12px; font-size:13px; cursor:pointer; display:flex; align-items:center; gap:6px;
    box-shadow:0 2px 10px rgba(0,0,0,.06); }
  .settings-btn:active{ transform:scale(.98) }
  .gear{ width:16px; height:16px; display:inline-block }

  .card{ background:var(--card); border:1px solid var(--border); border-radius:16px; padding:16px; box-shadow:0 2px 8px rgba(0,0,0,.04); }
  .grid{ display:grid; gap:16px; grid-template-columns: repeat(12, 1fr); }
  .col-12{ grid-column:span 12; }
  .col-6{ grid-column:span 12; }
  @media(min-width:800px){ .col-6{ grid-column:span 6; } }

  .stats{ display:grid; grid-template-columns:repeat(2,minmax(0,1fr)); gap:12px; }
  .stat{ border:1px dashed var(--border); border-radius:12px; padding:12px; }
  .stat .label{ color:var(--muted); font-size:12px; }
  .stat .value{ font-weight:800; font-size:20px; margin-top:6px; }

  .progress-wrap{ position:relative; }
  .progress{ height:16px; width:100%; background:#e9edf3; border-radius:999px; overflow:visible; border:1px solid var(--border); position:relative; }
  .bar{ height:100%; width:0%; border-radius:999px;
        background:linear-gradient(90deg, #e53935 0%, #fb8c00 25%, #fdd835 50%, #7cb342 75%, #43a047 100%);
        transition: width .6s ease; }
  .car{ position:absolute; top:-18px; width:34px; height:34px; transform:translateX(-50%); transition:left .6s ease; pointer-events:none; }

  .controls{ display:flex; gap:10px; flex-wrap:wrap; margin-top:12px; }
  button.primary{ background:var(--primary); color:#fff; border:none; padding:12px 16px; border-radius:12px; cursor:pointer; font-weight:800; font-size:15px; }
  button.primary:disabled{ opacity:.6; cursor:not-allowed }
  button.ghost{ background:transparent; color:var(--text); border:1px solid var(--border); padding:12px 16px; border-radius:12px; cursor:pointer; font-weight:600; }
  .muted{ color:var(--muted); font-size:13px; }

  .alert{ margin-top:12px; padding:10px 12px; border-radius:10px; border:1px solid var(--border); font-weight:700; }
  .alert.due{ color:#fff; background:var(--danger); border-color:#c62828; }
  .alert.ok{ color:#fff; background:var(--success); border-color:#1b5e20; }

  .modal-backdrop{ position:fixed; inset:0; background:rgba(0,0,0,.35); display:none; align-items:center; justify-content:center; padding:16px; z-index:50; }
  .modal{ width:100%; max-width:640px; background:var(--card); color:var(--text); border:1px solid var(--border); border-radius:16px; padding:16px; }
  .modal h3{ margin:0 0 8px; }
  .modal .row{ display:flex; gap:10px; flex-wrap:wrap; }
  .modal .item{ border:1px solid var(--border); border-radius:12px; padding:12px; flex:1 1 220px; }
  .modal label{ display:block; font-size:12px; color:var(--muted); margin-bottom:6px; }
  input[type="text"], input[type="password"]{ width:100%; padding:10px 12px; border:1px solid var(--border); border-radius:10px; background:transparent; color:var(--text); }
  .colors{ display:grid; grid-template-columns:repeat(8, 1fr); gap:8px; }
  .swatch{ border-radius:10px; height:34px; border:1px solid var(--border); cursor:pointer; }
  #photoInput{ display:none }

  table{ width:100%; border-collapse:collapse; }
  th, td{ text-align:left; padding:8px 10px; border-bottom:1px solid var(--border); font-size:13.5px; }
  th{ color:var(--muted); font-weight:700; }

  #printable{ display:none; }
  @media print{
    body *{ visibility:hidden; }
    #printable, #printable *{ visibility:visible; }
    #printable{ display:block; position:fixed; inset:0; padding:24px; background:#fff; color:#000; }
  }
</style>
</head>
<body class="theme-blue">
  <div class="wrap">
    <button class="settings-btn" id="openSettings" title="‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤">
      <svg class="gear" viewBox="0 0 24 24" fill="none" aria-hidden="true">
        <path d="M12 15.5a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7Z" stroke="currentColor" stroke-width="1.5"/>
        <path d="m6.5 8.4 1.2-2.1 2.2.5M17.5 8.4l-1.2-2.1-2.2.5M6.5 15.6l1.2 2.1 2.2-.5M17.5 15.6l-1.2 2.1-2.2-.5" stroke="currentColor" stroke-width="1.5" />
      </svg>
      ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤
    </button>

    <header>
      <div class="avatar" id="avatar">
        <img id="avatarImg" alt="‡∏†‡∏≤‡∏û‡∏£‡∏ñ" src='data:image/svg+xml;utf8,<?xml version="1.0" encoding="UTF-8"?><svg xmlns="http://www.w3.org/2000/svg" width="256" height="256" viewBox="0 0 256 256"><rect width="256" height="256" rx="24" fill="%23e9f2ff"/><g fill="%232b6cb0"><path d="M44 148h168a12 12 0 0 0 12-12v-10a28 28 0 0 0-15.6-25l-37.7-19A64 64 0 0 0 138 76h-20a64 64 0 0 0-32.7 8.1l-37.7 19A28 28 0 0 0 32 126v10a12 12 0 0 0 12 12Z"/><circle cx="76" cy="176" r="18"/><circle cx="180" cy="176" r="18"/><rect x="32" y="140" width="192" height="24" rx="6"/></g></svg>' />
      </div>
      <div class="titlebox">
        <div class="name" id="ownerName">‡∏£‡∏ñ‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô</div>
        <div class="subtitle" id="summaryLine">‡∏ú‡πà‡∏≠‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏•‡∏∞ 10,951 ‡∏ö‡∏≤‡∏ó / ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î 84 ‡∏á‡∏ß‡∏î</div>
        <div class="muted">‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡πÉ‡∏ï‡πâ‡∏£‡∏π‡∏õ (‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏î‡πâ‡πÉ‡∏ô ‚Äú‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‚Äù)</div>
      </div>
    </header>

    <div class="grid">
      <div class="col-12 card">
        <div style="display:flex; align-items:center; justify-content:space-between; gap:14px; flex-wrap:wrap;">
          <div style="min-width:260px; flex:1 1 360px;">
            <div class="stats" style="margin-bottom:12px;">
              <div class="stat"><div class="label">‡∏á‡∏ß‡∏î‡∏ó‡∏µ‡πà‡∏à‡πà‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß</div><div class="value" id="paidCount">0 ‡∏á‡∏ß‡∏î</div></div>
              <div class="stat"><div class="label">‡∏á‡∏ß‡∏î‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠</div><div class="value" id="leftCount">84 ‡∏á‡∏ß‡∏î</div></div>
              <div class="stat"><div class="label">‡∏ä‡∏≥‡∏£‡∏∞‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß</div><div class="value" id="paidAmount">‡∏ø 0</div></div>
              <div class="stat"><div class="label">‡∏¢‡∏≠‡∏î‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÇ‡∏î‡∏¢‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì</div><div class="value" id="leftAmount">‡∏ø 0</div></div>
              <div class="stat" style="grid-column:span 2;"><div class="label">‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠ (‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì)</div><div class="value" id="leftTime">7 ‡∏õ‡∏µ 0 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</div></div>
            </div>

            <div class="progress-wrap">
              <div class="progress" title="‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤">
                <div class="bar" id="bar"></div>
                <svg class="car" id="carIcon" viewBox="0 0 64 64" aria-hidden="true">
                  <path d="M6 36h52a3 3 0 0 0 3-3v-4a8 8 0 0 0-4.4-7.1L41 13.8A18 18 0 0 0 33.5 12h-3A18 18 0 0 0 22 13.8L7.4 21.9A8 8 0 0 0 4 29v4a3 3 0 0 0 3 3Z" fill="#263238"/>
                  <circle cx="20" cy="44" r="6" fill="#90a4ae"/>
                  <circle cx="44" cy="44" r="6" fill="#90a4ae"/>
                </svg>
              </div>
            </div>

            <div class="controls">
              <button class="primary" id="payBtn">‡∏à‡πà‡∏≤‡∏¢‡∏á‡∏ß‡∏î‡∏ô‡∏µ‡πâ</button>
              <button class="ghost" id="undoBtn">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏á‡∏ß‡∏î‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</button>
              <button class="ghost" id="resetBtn">‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡πÄ‡∏õ‡πá‡∏ô 84 ‡∏á‡∏ß‡∏î</button>
              <span class="muted" id="doneNote" style="display:none;">‡∏ä‡∏≥‡∏£‡∏∞‡∏Ñ‡∏£‡∏ö‡πÅ‡∏•‡πâ‡∏ß üéâ</span>
            </div>

            <div id="dueAlert" class="alert due" style="display:none;">‡∏Ñ‡∏£‡∏ö‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà 25/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô ‚Äî ‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ä‡∏≥‡∏£‡∏∞‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà 23</div>

            <div class="tip muted" style="margin-top:6px;">* ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡∏Å‡∏î ‚Äú‡∏à‡πà‡∏≤‡∏¢‡∏á‡∏ß‡∏î‡∏ô‡∏µ‡πâ‚Äù, ‚Äú‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏á‡∏ß‡∏î‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‚Äù ‡πÅ‡∏•‡∏∞ ‚Äú‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‚Äù ‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</div>
          </div>

          <div class="stat" style="min-width:260px; flex:1 1 280px;">
            <div class="label">‡∏™‡∏£‡∏∏‡∏õ‡πÅ‡∏ú‡∏ô</div>
            <div class="value" id="planLine" style="font-size:16px; line-height:1.3; font-weight:800; margin-top:8px;"></div>
            <div class="muted" style="margin-top:6px;">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡πÉ‡∏ô‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ô‡∏µ‡πâ (localStorage)</div>
            <div style="margin-top:10px;">
              <details>
                <summary style="cursor:pointer; font-weight:700;">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏à‡πà‡∏≤‡∏¢ (‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î)</summary>
                <div style="max-height:220px; overflow:auto; margin-top:8px;">
                  <table id="historyTable">
                    <thead><tr><th>#</th><th>‡∏ß‡∏±‡∏ô-‡πÄ‡∏ß‡∏•‡∏≤</th></tr></thead>
                    <tbody></tbody>
                  </table>
                </div>
              </details>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- SETTINGS MODAL -->
  <div class="modal-backdrop" id="settingsModal">
    <div class="modal">
      <h3>‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</h3>
      <div class="row">
        <div class="item">
          <label>‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</label>
          <input type="file" id="photoInput" accept="image/*" />
          <button class="ghost" id="choosePhoto">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏£‡∏π‡∏õ‚Ä¶</button>
          <div class="tip">‡∏£‡∏π‡∏õ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏Ñ‡∏£‡∏≠‡∏ö‡πÄ‡∏õ‡πá‡∏ô‡∏ß‡∏á‡∏Å‡∏•‡∏°‡πÇ‡∏î‡∏¢‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</div>
        </div>
        <div class="item">
          <label>‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ä‡∏∑‡πà‡∏≠ (‡πÉ‡∏ï‡πâ‡∏£‡∏π‡∏õ)</label>
          <input type="text" id="nameInput" placeholder="‡πÄ‡∏ä‡πà‡∏ô My City Car" />
          <div style="display:flex; gap:8px; margin-top:8px;">
            <button class="primary" id="saveName">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ä‡∏∑‡πà‡∏≠</button>
          </div>
        </div>
        <div class="item" style="flex:1 1 100%;">
          <label>‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ò‡∏µ‡∏°‡∏™‡∏µ</label>
          <div class="colors">
            <button class="swatch" data-theme="theme-blue"   style="background:#f5faff"></button>
            <button class="swatch" data-theme="theme-pink"   style="background:#fff0f7"></button>
            <button class="swatch" data-theme="theme-white"  style="background:#ffffff; border:1px solid #ddd"></button>
            <button class="swatch" data-theme="theme-black"  style="background:#0f1115"></button>
            <button class="swatch" data-theme="theme-rosegold" style="background:#fff2ef"></button>
            <button class="swatch" data-theme="theme-yellow" style="background:#fff8c6"></button>
            <button class="swatch" data-theme="theme-orange" style="background:#ffe1cc"></button>
            <button class="swatch" data-theme="theme-red"    style="background:#ffd6d9"></button>
            <button class="swatch" data-theme="theme-purple" style="background:#f3e9ff"></button>
            <button class="swatch" data-theme="theme-teal"   style="background:#e5fbf6"></button>
            <button class="swatch" data-theme="theme-green"  style="background:#eaf7ed"></button>
            <button class="swatch" data-theme="theme-slate"  style="background:#f1f5f9"></button>
            <button class="swatch" data-theme="theme-brown"  style="background:#fff0e6"></button>
            <button class="swatch" data-theme="theme-lavender" style="background:#f4efff"></button>
            <button class="swatch" data-theme="theme-mint"   style="background:#e9fff5"></button>
            <button class="swatch" data-theme="theme-navy"   style="background:#e7ecff"></button>
          </div>
          <div class="tip">‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å: ‡∏ü‡πâ‡∏≤‡∏≠‡πà‡∏≠‡∏ô, ‡∏ä‡∏°‡∏û‡∏π‡∏≠‡πà‡∏≠‡∏ô, ‡∏Ç‡∏≤‡∏ß, ‡∏î‡∏≥, ‡πÇ‡∏£‡∏™‡πÇ‡∏Å‡∏•‡∏î‡πå, ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á, ‡∏™‡πâ‡∏°, ‡πÅ‡∏î‡∏á, ‡∏°‡πà‡∏ß‡∏á, ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß‡∏≠‡∏°‡∏ü‡πâ‡∏≤, ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß, ‡∏™‡πÄ‡∏•‡∏ï, ‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏•, ‡∏•‡∏≤‡πÄ‡∏ß‡∏ô‡πÄ‡∏î‡∏≠‡∏£‡πå, ‡∏°‡∏¥‡πâ‡∏ô‡∏ï‡πå, ‡πÄ‡∏ô‡∏ß‡∏µ‡πà</div>
        </div>
        <div class="item" style="flex:1 1 100%;">
          <label>‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏à‡πà‡∏≤‡∏¢‡∏á‡∏ß‡∏î / ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏á‡∏ß‡∏î / ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï</label>
          <div class="row" style="gap:8px;">
            <input type="password" id="oldPass" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏î‡∏¥‡∏° (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)" style="flex:1 1 160px;">
            <input type="password" id="newPass" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà" style="flex:1 1 160px;">
            <input type="password" id="newPass2" placeholder="‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà" style="flex:1 1 160px;">
            <button class="primary" id="savePass">‡∏ï‡∏±‡πâ‡∏á/‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏´‡∏±‡∏™</button>
          </div>
        </div>
        <div class="item" style="flex:1 1 100%;">
          <label>‡∏™‡∏£‡∏∏‡∏õ‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏ü‡∏•‡πå PDF</label>
          <div class="row" style="gap:8px; align-items:center;">
            <button class="ghost" id="printPDF">‡∏™‡∏£‡πâ‡∏≤‡∏á/‡∏û‡∏¥‡∏°‡∏û‡πå PDF ‡∏™‡∏£‡∏∏‡∏õ</button>
            <div class="tip">‡∏à‡∏∞‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏û‡∏¥‡∏°‡∏û‡πå ‡πÉ‡∏´‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏õ‡πá‡∏ô PDF</div>
          </div>
        </div>
      </div>
      <div style="display:flex; justify-content:flex-end; gap:8px; margin-top:12px;">
        <button class="ghost" id="closeSettings">‡∏õ‡∏¥‡∏î</button>
      </div>
    </div>
  </div>

  <!-- PASSWORD PROMPT -->
  <div class="modal-backdrop" id="passPrompt">
    <div class="modal" style="max-width:400px;">
      <h3>‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</h3>
      <input type="password" id="passInput" placeholder="‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏≥‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£" />
      <div style="display:flex; justify-content:flex-end; gap:8px; margin-top:12px;">
        <button class="ghost" id="cancelPay">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
        <button class="primary" id="confirmPay">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</button>
      </div>
      <div class="tip" id="passHint" style="display:none; color:#e63946;">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á</div>
    </div>
  </div>

  <!-- PRINT AREA -->
  <div id="printable">
    <h2 style="margin:0 0 8px;">‡∏™‡∏£‡∏∏‡∏õ‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡∏Ñ‡πà‡∏≤‡∏á‡∏ß‡∏î‡∏£‡∏ñ</h2>
    <div id="printMeta" style="margin-bottom:8px;">‚Äî</div>
    <table id="printTable">
      <thead>
        <tr><th style="width:60px;">‡∏•‡∏≥‡∏î‡∏±‡∏ö</th><th>‡∏ß‡∏±‡∏ô‡πÄ‡∏ß‡∏•‡∏≤</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

<script>
  // ====== CONFIG ======
  const MONTHLY = 10951;       // ‡∏ú‡πà‡∏≠‡∏ô‡∏ï‡πà‡∏≠‡πÄ‡∏î‡∏∑‡∏≠‡∏ô
  const TOTAL_INSTALLMENTS = 84;
  const DUE_DAY = 25;   // ‡∏ß‡∏±‡∏ô‡∏Ñ‡∏£‡∏ö‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏à‡∏£‡∏¥‡∏á‡∏Ç‡∏≠‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞‡πÄ‡∏î‡∏∑‡∏≠‡∏ô
  const WARN_DAY = 23;  // ‡∏ß‡∏±‡∏ô‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡∏ï‡∏±‡∏ß‡∏™‡∏µ‡πÅ‡∏î‡∏á

  // ====== STORAGE KEYS ======
  const K = {
    paid: 'car.paid',
    name: 'car.name',
    theme: 'car.theme',
    photo: 'car.photo',
    passSalt: 'car.pass.salt',
    passHash: 'car.pass.hash',
    history: 'car.history' // [{ts: number}]
  };

  // ====== UTIL ======
  const fmtMoney = n => n.toLocaleString('th-TH', { maximumFractionDigits: 0 });
  const fmtDateTime = ts => new Date(ts).toLocaleString('th-TH');
  const clamp = (n,min,max)=> Math.min(Math.max(n,min),max);

  function calcTimeLeft(remaining){
    const years = Math.floor(remaining / 12);
    const months = remaining % 12;
    return `${years} ‡∏õ‡∏µ ${months} ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô`;
  }

  function setTheme(themeClass){
    const body = document.body;
    body.classList.remove('theme-blue','theme-pink','theme-white','theme-black','theme-rosegold','theme-yellow','theme-orange','theme-red','theme-purple','theme-teal','theme-green','theme-slate','theme-brown','theme-lavender','theme-mint','theme-navy');
    body.classList.add(themeClass);
    localStorage.setItem(K.theme, themeClass);
  }

  // Web Crypto helpers (hash password)
  async function sha256(data){
    const enc = new TextEncoder();
    const buf = await crypto.subtle.digest('SHA-256', enc.encode(data));
    return btoa(String.fromCharCode(...new Uint8Array(buf)));
  }
  function randomSalt(len=16){
    const arr = new Uint8Array(len);
    crypto.getRandomValues(arr);
    return btoa(String.fromCharCode(...arr));
  }
  async function setPassword(newPass){
    const salt = randomSalt();
    const hash = await sha256(salt + ':' + newPass);
    localStorage.setItem(K.passSalt, salt);
    localStorage.setItem(K.passHash, hash);
  }
  async function verifyPassword(pass){
    const salt = localStorage.getItem(K.passSalt);
    const hash = localStorage.getItem(K.passHash);
    if(!salt || !hash) return false;
    const tryHash = await sha256(salt + ':' + pass);
    return tryHash === hash;
  }
  function hasPassword(){ return !!(localStorage.getItem(K.passSalt) && localStorage.getItem(K.passHash)); }

  // ====== STATE ======
  let paid = parseInt(localStorage.getItem(K.paid) || '0', 10);
  let nameStr = localStorage.getItem(K.name) || '‡∏£‡∏ñ‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô';
  let theme = localStorage.getItem(K.theme) || 'theme-blue';
  setTheme(theme);
  let history = [];
  try { history = JSON.parse(localStorage.getItem(K.history) || '[]'); } catch { history = []; }

  // Seed starting history if first time (‡πÄ‡∏£‡∏¥‡πà‡∏° 04/2568, ‡∏à‡πà‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß 4 ‡∏á‡∏ß‡∏î 25/04,25/05,25/06,25/07/2568)
  if(history.length === 0 && paid === 0){
    history = [
      { ts: Date.parse('2025-04-25T09:00:00+07:00') },
      { ts: Date.parse('2025-05-25T09:00:00+07:00') },
      { ts: Date.parse('2025-06-25T09:00:00+07:00') },
      { ts: Date.parse('2025-07-25T09:00:00+07:00') }
    ];
    paid = history.length;
    localStorage.setItem(K.history, JSON.stringify(history));
    localStorage.setItem(K.paid, String(paid));
  }

  // Photo
  const savedPhoto = localStorage.getItem(K.photo);
  if(savedPhoto){ document.getElementById('avatarImg').src = savedPhoto; }

  // Bind UI
  const ownerName = document.getElementById('ownerName');
  const summaryLine = document.getElementById('summaryLine');
  const planLine = document.getElementById('planLine');
  const paidCount = document.getElementById('paidCount');
  const leftCount = document.getElementById('leftCount');
  const leftAmount = document.getElementById('leftAmount');
  const paidAmount = document.getElementById('paidAmount');
  const leftTime = document.getElementById('leftTime');
  const bar = document.getElementById('bar');
  const carIcon = document.getElementById('carIcon');
  const payBtn = document.getElementById('payBtn');
  const undoBtn = document.getElementById('undoBtn');
  const resetBtn = document.getElementById('resetBtn');
  const doneNote = document.getElementById('doneNote');
  const dueAlert = document.getElementById('dueAlert');
  const historyBody = document.querySelector('#historyTable tbody');

  function refresh(){
    paid = clamp(paid, 0, TOTAL_INSTALLMENTS);
    const remaining = TOTAL_INSTALLMENTS - paid;
    const leftMoney = remaining * MONTHLY;
    const paidMoney = paid * MONTHLY;
    const pct = (paid / TOTAL_INSTALLMENTS) * 100;

    ownerName.textContent = nameStr;
    summaryLine.textContent = `‡∏ú‡πà‡∏≠‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏•‡∏∞ ${MONTHLY.toLocaleString('th-TH')} ‡∏ö‡∏≤‡∏ó / ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ${TOTAL_INSTALLMENTS} ‡∏á‡∏ß‡∏î`;
    planLine.textContent = `‡∏ä‡∏≥‡∏£‡∏∞‡πÅ‡∏•‡πâ‡∏ß ${paid} ‡∏á‡∏ß‡∏î  |  ‡πÄ‡∏´‡∏•‡∏∑‡∏≠ ${remaining} ‡∏á‡∏ß‡∏î  |  ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÄ‡∏á‡∏¥‡∏ô ~ ‡∏ø${fmtMoney(leftMoney)}`;

    paidCount.textContent = `${paid} ‡∏á‡∏ß‡∏î`;
    leftCount.textContent = `${remaining} ‡∏á‡∏ß‡∏î`;
    leftAmount.textContent = `‡∏ø ${fmtMoney(leftMoney)}`;
    paidAmount.textContent = `‡∏ø ${fmtMoney(paidMoney)}`;
    leftTime.textContent = calcTimeLeft(remaining);

    bar.style.width = pct + '%';
    const progRect = document.querySelector('.progress').getBoundingClientRect();
    const leftPos = Math.max(8, Math.min(progRect.width - 8, progRect.width * (pct/100)));
    carIcon.style.left = leftPos + 'px';

    if(remaining === 0){
      payBtn.disabled = true; undoBtn.disabled = true;
      doneNote.style.display = '';
    }else{
      payBtn.disabled = false; undoBtn.disabled = (paid === 0);
      doneNote.style.display = 'none';
    }

    // history table (latest first)
    historyBody.innerHTML = '';
    const recent = [...history].reverse().slice(0, 20);
    recent.forEach((h, i)=>{
      const tr = document.createElement('tr');
      const idx = document.createElement('td'); idx.textContent = String(recent.length - i);
      const dt = document.createElement('td'); dt.textContent = fmtDateTime(h.ts);
      tr.append(idx, dt);
      historyBody.appendChild(tr);
    });

    updateDueAlert();
  }

  function updateDueAlert(){
    const now = new Date();
    const m = now.getMonth();
    const y = now.getFullYear();
    const paidThisMonth = history.some(h=>{ const t = new Date(h.ts); return t.getMonth()===m && t.getFullYear()===y; });
    if(paidThisMonth){
      dueAlert.textContent = '‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡∏ä‡∏≥‡∏£‡∏∞‡πÅ‡∏•‡πâ‡∏ß';
      dueAlert.className = 'alert ok';
      dueAlert.style.display = 'block';
    }else{
      dueAlert.textContent = `‡∏Ñ‡∏£‡∏ö‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà ${String(DUE_DAY).padStart(2,'0')}/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô ‚Äî ‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ä‡∏≥‡∏£‡∏∞‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà ${String(WARN_DAY).padStart(2,'0')}`;
      dueAlert.className = 'alert due';
      dueAlert.style.display = 'block';
    }
  }

  refresh();

  // Settings modal
  const settingsModal = document.getElementById('settingsModal');
  document.getElementById('openSettings').onclick = () => settingsModal.style.display = 'flex';
  document.getElementById('closeSettings').onclick = () => settingsModal.style.display = 'none';

  const nameInput = document.getElementById('nameInput');
  nameInput.value = nameStr;
  document.getElementById('saveName').onclick = () => {
    const v = nameInput.value.trim();
    if(v){ nameStr = v; localStorage.setItem(K.name, nameStr); refresh(); }
  };

  document.querySelectorAll('.swatch').forEach(btn=>{
    btn.addEventListener('click', ()=> setTheme(btn.dataset.theme));
  });

  const choosePhoto = document.getElementById('choosePhoto');
  const photoInput = document.getElementById('photoInput');
  choosePhoto.onclick = ()=> photoInput.click();
  photoInput.onchange = ()=>{
    const file = photoInput.files?.[0];
    if(!file) return;
    const reader = new FileReader();
    reader.onload = e=>{
      const dataUrl = e.target.result;
      localStorage.setItem(K.photo, dataUrl);
      document.getElementById('avatarImg').src = dataUrl;
    };
    reader.readAsDataURL(file);
  };

  document.getElementById('savePass').onclick = async ()=>{
    const oldPass = document.getElementById('oldPass').value;
    const newPass = document.getElementById('newPass').value;
    const newPass2= document.getElementById('newPass2').value;

    if(!newPass || newPass.length < 4){ alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 4 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£'); return; }
    if(newPass !== newPass2){ alert('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô'); return; }
    if(hasPassword()){
      const ok = await verifyPassword(oldPass);
      if(!ok){ alert('‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏î‡∏¥‡∏°‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á'); return; }
    }
    await setPassword(newPass);
    document.getElementById('oldPass').value='';
    document.getElementById('newPass').value='';
    document.getElementById('newPass2').value='';
    alert('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢');
  };

  // Shared password prompt
  const passPrompt = document.getElementById('passPrompt');
  const passInput = document.getElementById('passInput');
  const passHint = document.getElementById('passHint');
  const openPassPrompt = ()=>{ passHint.style.display = 'none'; passInput.value = ''; passPrompt.style.display = 'flex'; setTimeout(()=> passInput.focus(), 50); };
  const closePassPrompt = ()=> passPrompt.style.display = 'none';
  document.getElementById('cancelPay').onclick = closePassPrompt;

  let pendingAction = null; // 'pay' | 'reset' | 'undo'

  payBtn.onclick = ()=>{
    if(!hasPassword()){
      settingsModal.style.display = 'flex';
      alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡πà‡∏≠‡∏ô ‡πÅ‡∏•‡πâ‡∏ß‡∏à‡∏∂‡∏á‡∏ó‡∏≥‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏à‡πà‡∏≤‡∏¢‡∏á‡∏ß‡∏î');
      return;
    }
    pendingAction = 'pay';
    openPassPrompt();
  };

  resetBtn.onclick = ()=>{
    if(!hasPassword()){
      settingsModal.style.display = 'flex';
      alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡πà‡∏≠‡∏ô ‡πÅ‡∏•‡πâ‡∏ß‡∏à‡∏∂‡∏á‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï');
      return;
    }
    pendingAction = 'reset';
    openPassPrompt();
  };

  undoBtn.onclick = ()=>{
    if(!hasPassword()){
      settingsModal.style.display = 'flex';
      alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡πà‡∏≠‡∏ô ‡πÅ‡∏•‡πâ‡∏ß‡∏à‡∏∂‡∏á‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏á‡∏ß‡∏î‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î');
      return;
    }
    if(paid <= 0 || history.length === 0){
      alert('‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏á‡∏ß‡∏î‡πÉ‡∏´‡πâ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å');
      return;
    }
    pendingAction = 'undo';
    openPassPrompt();
  };

  document.getElementById('confirmPay').onclick = async ()=>{
    const ok = await verifyPassword(passInput.value);
    if(!ok){ passHint.style.display = ''; passInput.select(); return; }
    closePassPrompt();

    if(pendingAction === 'pay'){
      if(paid >= TOTAL_INSTALLMENTS){ refresh(); pendingAction = null; return; }
      paid += 1;
      localStorage.setItem(K.paid, String(paid));
      history.push({ ts: Date.now() });
      localStorage.setItem(K.history, JSON.stringify(history));
      refresh();
    }
    else if(pendingAction === 'reset'){
      if(confirm('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏á‡∏ß‡∏î‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏õ‡πá‡∏ô 84 ‡∏á‡∏ß‡∏î ‡πÅ‡∏•‡∏∞‡∏•‡∏ö‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏à‡πà‡∏≤‡∏¢‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î?')){
        paid = 0;
        localStorage.setItem(K.paid, '0');
        history = [];
        localStorage.setItem(K.history, JSON.stringify(history));
        refresh();
      }
    }
    else if(pendingAction === 'undo'){
      if(paid > 0 && history.length > 0){
        paid -= 1;
        localStorage.setItem(K.paid, String(paid));
        history.pop();
        localStorage.setItem(K.history, JSON.stringify(history));
        refresh();
      }
    }
    pendingAction = null;
  };

  [settingsModal, passPrompt].forEach(m=>{
    m.addEventListener('click', (e)=>{ if(e.target === m) m.style.display = 'none'; });
  });

  // Print PDF
  document.getElementById('printPDF').onclick = ()=>{
    const remaining = TOTAL_INSTALLMENTS - paid;
    const leftMoney = remaining * MONTHLY;
    const paidMoney = paid * MONTHLY;
    const meta = `‡∏ä‡∏∑‡πà‡∏≠: ${nameStr} | ‡∏ú‡πà‡∏≠‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏•‡∏∞ ${MONTHLY.toLocaleString('th-TH')} ‡∏ö‡∏≤‡∏ó | ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ${TOTAL_INSTALLMENTS} ‡∏á‡∏ß‡∏î\n‡∏ä‡∏≥‡∏£‡∏∞‡πÅ‡∏•‡πâ‡∏ß ${paid} ‡∏á‡∏ß‡∏î (‡∏ø${fmtMoney(paidMoney)}) | ‡πÄ‡∏´‡∏•‡∏∑‡∏≠ ${remaining} ‡∏á‡∏ß‡∏î (‡∏ø${fmtMoney(leftMoney)})`;
    document.getElementById('printMeta').textContent = meta;

    const tbody = document.querySelector('#printTable tbody');
    tbody.innerHTML = '';
    history.forEach((h, i)=>{
      const tr = document.createElement('tr');
      const c1 = document.createElement('td'); c1.textContent = String(i+1);
      const c2 = document.createElement('td'); c2.textContent = fmtDateTime(h.ts);
      tr.append(c1,c2); tbody.appendChild(tr);
    });

    window.print();
  };
</script>
</body>
</html>
